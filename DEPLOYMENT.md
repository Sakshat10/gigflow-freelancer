# üöÄ Deployment Guide

This guide covers deploying your Gigflow Freelancer application using Railway (backend) and Vercel (frontend).

## üìã Prerequisites

- GitHub account
- Railway account (sign up at [railway.app](https://railway.app))
- Vercel account (sign up at [vercel.com](https://vercel.com))

---

## üõ§Ô∏è Backend Deployment (Railway)

### Step 1: Prepare Your Repository

1. **Push your code to GitHub:**
   ```bash
   git add .
   git commit -m "Prepare for Railway deployment"
   git push origin main
   ```

### Step 2: Create Railway Project

1. Go to [railway.app](https://railway.app) and login
2. Click **"New Project"**
3. Select **"Deploy from GitHub repo"**
4. Choose your `gigflow-freelancer` repository
5. Select **"Add variables"** before deploying

### Step 3: Add PostgreSQL Database

1. In your Railway project, click **"New"** ‚Üí **"Database"** ‚Üí **"Add PostgreSQL"**
2. Railway will automatically create a `DATABASE_URL` variable
3. The database will be linked to your service

### Step 4: Configure Environment Variables

Add these variables in Railway (Settings ‚Üí Variables):

```env
NODE_ENV=production
PORT=3000
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-minimum-32-chars
FRONTEND_URL=https://your-frontend-app.vercel.app
```

**Important:** 
- `DATABASE_URL` is auto-generated by Railway's PostgreSQL
- Update `FRONTEND_URL` after deploying frontend (Step 5)
- Generate a strong `JWT_SECRET` (use: `openssl rand -base64 32`)

### Step 5: Deploy

1. Railway will automatically detect the `Dockerfile` and build
2. Wait for deployment to complete (2-5 minutes)
3. Click on your service ‚Üí **"Settings"** ‚Üí **"Generate Domain"**
4. Copy your backend URL (e.g., `https://your-app.up.railway.app`)

### Step 6: Verify Deployment

Test your backend API:
```bash
curl https://your-app.up.railway.app/api/health
```

---

## üé® Frontend Deployment (Vercel)

### Step 1: Update Frontend Environment

Create `frontend/.env.production`:

```env
VITE_API_URL=https://your-app.up.railway.app
VITE_SOCKET_URL=https://your-app.up.railway.app
```

Replace `your-app.up.railway.app` with your Railway backend URL.

### Step 2: Update Frontend Configuration

If needed, update API URLs in your frontend code to use environment variables:

```typescript
// frontend/src/services/api.ts
const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:3000';
const SOCKET_URL = import.meta.env.VITE_SOCKET_URL || 'http://localhost:3000';
```

### Step 3: Deploy to Vercel

**Option A: Using Vercel CLI**
```bash
cd frontend
npm install -g vercel
vercel login
vercel --prod
```

**Option B: Using Vercel Dashboard**
1. Go to [vercel.com](https://vercel.com) and login
2. Click **"Add New"** ‚Üí **"Project"**
3. Import your GitHub repository
4. Configure:
   - **Framework Preset:** Vite
   - **Root Directory:** `frontend`
   - **Build Command:** `npm run build`
   - **Output Directory:** `dist`
5. Add environment variables:
   ```
   VITE_API_URL=https://your-app.up.railway.app
   VITE_SOCKET_URL=https://your-app.up.railway.app
   ```
6. Click **"Deploy"**

### Step 4: Update Backend CORS

Go back to Railway and update the `FRONTEND_URL` variable:
```env
FRONTEND_URL=https://your-app.vercel.app
```

Then update your backend CORS configuration in `backend/next.config.ts` or API routes.

---

## üîÑ Continuous Deployment

Both Railway and Vercel support automatic deployments:

- **Railway:** Auto-deploys on push to `main` branch
- **Vercel:** Auto-deploys on push to `main` branch

To enable:
1. Connect your GitHub repo to both platforms
2. Configure branch deployment settings
3. Every push will trigger a new deployment

---

## üîç Monitoring & Logs

### Railway Logs
```bash
# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# View logs
railway logs
```

### Vercel Logs
- View in Vercel Dashboard ‚Üí Your Project ‚Üí Deployments ‚Üí Click deployment ‚Üí Logs

---

## üõ†Ô∏è Troubleshooting

### Backend Issues

**Database Connection Failed:**
- Verify `DATABASE_URL` is set in Railway
- Check PostgreSQL service is running
- Run migrations manually: `railway run npx prisma migrate deploy`

**Port Already in Use:**
- Railway automatically assigns `PORT` variable
- Ensure your `server.ts` uses `process.env.PORT`

**File Uploads Not Working:**
- Create persistent volume in Railway (Settings ‚Üí Volumes)
- Mount to `/app/uploads`

### Frontend Issues

**API Calls Failing:**
- Check `VITE_API_URL` is set correctly
- Verify CORS is configured on backend
- Check Network tab in browser DevTools

**Build Failed:**
- Check build logs in Vercel
- Verify all dependencies are in `package.json`
- Try building locally: `npm run build`

---

## üí∞ Cost Estimates

### Railway
- **Free Tier:** $5 credit/month
- **Hobby Plan:** $5/month (500MB RAM, shared CPU)
- **PostgreSQL:** Included in plan

### Vercel
- **Free Tier:** 
  - 100GB bandwidth/month
  - Unlimited deployments
  - Perfect for frontend hosting

**Total Monthly Cost:** $0-5 (can run entirely free with Railway credits)

---

## üìö Additional Resources

- [Railway Documentation](https://docs.railway.app)
- [Vercel Documentation](https://vercel.com/docs)
- [Prisma Deployment Guide](https://www.prisma.io/docs/guides/deployment)
- [Socket.IO Production Guide](https://socket.io/docs/v4/production-checklist/)

---

## üîê Security Checklist

- [ ] Generate strong `JWT_SECRET` (min 32 characters)
- [ ] Set `NODE_ENV=production`
- [ ] Configure CORS with specific origins
- [ ] Enable HTTPS only (automatic on Railway/Vercel)
- [ ] Review Prisma schema for sensitive data
- [ ] Set up database backups in Railway
- [ ] Add rate limiting to API routes
- [ ] Enable Railway's network policies

---

## üéâ Post-Deployment

After successful deployment:

1. **Test all features:**
   - User authentication
   - Workspace creation
   - File uploads
   - Real-time chat
   - Invoice generation

2. **Set up monitoring:**
   - Railway metrics dashboard
   - Vercel analytics
   - Error tracking (Sentry)

3. **Configure custom domain (optional):**
   - Add domain in Railway settings
   - Add domain in Vercel settings
   - Update DNS records

---

Need help? Check the troubleshooting section or reach out to Railway/Vercel support.
